(function($){Drupal.behaviors.ALSFPFPSearch={attach:function(context,settings){var formID='views-exposed-form-fundraiser-location-search-page';var elementID='edit-location-origin';var locationField=$('form#'+formID+' input#'+elementID);locationField.once('showhide',function(){if(typeof locationField!="undefined"&&locationField.length>0&&typeof google!="undefined"&&typeof google.maps.places!="undefined"){autocomplete=new google.maps.places.Autocomplete((document.getElementById(elementID)),{types:['(cities)'],componentRestrictions:{'country':'us'}});}});var formID='alsf-pfp-stands-near-me-form';var elementID='edit-location';var locationField=$('form#'+formID+' input#'+elementID);locationField.once('showhide',function(){if(typeof locationField!="undefined"&&locationField.length>0&&typeof google!="undefined"&&typeof google.maps.places!="undefined"){autocomplete=new google.maps.places.Autocomplete((document.getElementById(elementID)),{types:['(cities)'],componentRestrictions:{'country':'us'}});}});$('#views-exposed-form-fundraiser-location-search-page').once('alsf-pfp-location-search-elements',function(){$(this).find('.form-item-location-distance').hide();$(this).find('.form-item-location-unit').hide();$(this).find('.geofield-proximity-origin-from').remove();$(this).find('#edit-bbox').remove();});$('div.leaflet-container').once('alsf-pfp-leaflet-actions',function(){var mapId=$(this).attr('id');for(var i=0;i<settings.leaflet.length;i++){if(settings.leaflet[i].mapId==mapId){var lMap=settings.leaflet[i].lMap;lMap.on('moveend',function(){newBounds=lMap.getBounds();bounds_string=newBounds._northEast.lat+','+newBounds._southWest.lng+','+newBounds._southWest.lat+','+newBounds._northEast.lng;var href=window.location.pathname+'?bbox='+bounds_string;if($('#bounds-link').length==0){$('#map-link-redo').html('<a href="'+href+'" id="bounds-link">Redo search here</a>');$('#map-link-redo a').click(function(event){$('#map-link-redo').html('<span class="progress">Searching...</span>');});}else{$('#bounds-link').attr('href',href);}});}}});$('#map-links').once('alsf-pfp-map-links',function(){$('#map-link-near-me').html('<a href="#">Search near me</a>');$('#map-link-near-me a').click(function(event){$('#map-link-near-me').html('<span class="progress">Searching...</span>');navigator.geolocation.getCurrentPosition(function(pos){var crd=pos.coords;var width=0.025997628590289423;var height=0.04978179931728732;bounds_string=(crd.latitude-width/2)+','+(crd.longitude-height/2)+','+(crd.latitude+width/2)+','+(crd.longitude+height/2);var href=window.location.pathname+'?bbox='+bounds_string;window.location=href;},function(err){console.log(err.code);console.log(err.message);$('#map-link-near-me').html('<span class="error">Lookup failed.</span><a href="#">Try to search near me again</a>');},{enableHighAccuracy:true,timeout:5000,maximumAge:0});event.preventDefault();});});}};}(jQuery));