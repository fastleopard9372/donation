(function($){Drupal.ajax.prototype.commands.colorboxNodeReload=function(ajax,response){location.reload();};Drupal.ajax.prototype.commands.colorboxNodeRedirect=function(ajax,response){window.location.replace(response.data);};Drupal.behaviors.colorboxNode={attach:function(context,settings){if(!$.isFunction($.colorbox)||typeof settings.colorbox==='undefined'){return;}
if(settings.colorbox.mobiledetect&&window.matchMedia){var mq=window.matchMedia("(max-device-width: "+settings.colorbox.mobiledevicewidth+")");if(mq.matches){return;}}
$('.colorbox-node',context).once('init-colorbox-node-processed',function(){$(this).colorboxNode({'launch':false});});$('ul.contextual-links a',context).once('colorboxNodeContextual').click(function(){$.colorbox.close();});}};$.fn.colorboxNodeLaunch=function(settings){var $this=$(this).clone();if(!$this.hasClass('colorbox-node-gallery')){$this.attr('rel','');}
if(!hrefIsSafe(settings.href)){return;}
var innerWidth=$this.data('inner-width');var innerHeight=$this.data('inner-height');if(typeof innerWidth!='undefined'&&typeof innerHeight!='undefined'){var params=$.urlDataParams(innerWidth,innerHeight);}else{var params=$.urlParams(settings.href);}
if(params.innerHeight==undefined){params.innerHeight=settings.height;}
if(params.innerWidth==undefined){params.innerWidth=settings.width;}
params.html='<div id="colorboxNodeLoading"></div>';params.onComplete=function(){$this.colorboxNodeGroup();};params.open=true;$this.colorbox($.extend({},Drupal.settings.colorbox,params));};$.fn.colorboxNode=function(options){var $this=this;options=options||{};var settings={'launch':true,'width':Drupal.settings.colorbox_node.width,'height':Drupal.settings.colorbox_node.height};$.extend(settings,options);settings.href=$this.attr('data-href');if(typeof settings.href=='undefined'||settings.href==false){settings.href=$this.attr('href');}
settings.href=Drupal.checkPlain(settings.href).replaceAll('&amp;','&');var parse=document.createElement('a');parse.href=settings.href;if(!settings.href){alert(Drupal.t('No url found on element'));}
var base_path=Drupal.settings.basePath;var path_prefix=Drupal.settings.pathPrefix;var pathname=parse.pathname;if(pathname.charAt(0)!='/'){pathname='/'+parse.pathname;}
var cleanURLs=$.getParameterByName('q',settings.href);if(base_path!='/'){if(cleanURLs!=''){settings.link=pathname.replace(base_path,base_path+parse.search.replace('?q=','?q=/'+path_prefix+'colorbox/'));}else{settings.link=pathname.replace(base_path,base_path+path_prefix+'colorbox/')+parse.search;}}else{if(cleanURLs!=''){settings.link=base_path+parse.search.replace('?q=','?q=/'+path_prefix+'colorbox/');}else{settings.link=base_path+path_prefix+'colorbox'+pathname+parse.search;}}
var element_settings={};element_settings.async=true;element_settings.progress={'type':'none'};if(settings.link){element_settings.url=settings.link;element_settings.event='click';}
var base=Drupal.checkPlain($(this).attr('id'));Drupal.ajax[base]=new Drupal.ajax(base,this,element_settings);if(settings.launch){Drupal.ajax[base].eventResponse(this,'click');$(this).colorboxNodeLaunch(settings);}
else{$(this).click(function(){$(this).colorboxNodeLaunch(settings);});}};$.fn.colorboxNodeGroup=function(){var $this=$(this);var rel=Drupal.checkPlain($this.attr('rel'));if(rel&&$this.hasClass('colorbox-node-gallery')){if($('a.colorbox-node-gallery[rel="'+rel+'"]:not(#colorbox a[rel="'+rel+'"])').length>1){$related=$('a.colorbox-node-gallery[rel="'+rel+'"]:not(#colorbox a[rel="'+rel+'"])');var $related_unique=[];$related.each(function(){$.findHref($related_unique,this.href);if(!$.findHref($related_unique,this.href).length){$related_unique.push(this);}});var current=$.findHref($related_unique,$this.get(0).href);$related=$($related_unique);var idx=$related.index($(current));var tot=$related.length;$('#cboxPrevious, #cboxNext').show();$.colorbox.next=function(){index=get_index(1);$related[index].click();};$.colorbox.prev=function(){index=get_index(-1);$related[index].click();};$('#cboxCurrent').html(Drupal.settings.colorbox.current.replace('{current}',idx+1).replace('{total}',tot)).show();$('#cboxNext').html(Drupal.settings.colorbox.next).show();$('#cboxPrevious').html(Drupal.settings.colorbox.previous).show();var prefix='colorbox';$(document).unbind('keydown.'+prefix);$(document).bind('keydown.'+prefix,function(e){var key=e.keyCode;if($related[1]&&!e.altKey){if(key===37){e.preventDefault();$.colorbox.prev();}else if(key===39){e.preventDefault();$.colorbox.next();}}});}
function get_index(increment){var max=$related.length;var newIndex=(idx+increment)%max;return(newIndex<0)?max+newIndex:newIndex;}}};$.findHref=function(items,href){return $.grep(items,function(n,i){return n.href==href;});};$.urlParams=function(url){var p={},e,a=/\+/g,r=/([^&=]+)=?([^&]*)/g,d=function(s){return decodeURIComponent(s.replace(a,' '));},q=url.split('?');while(e=r.exec(q[1])){e[1]=d(e[1]);e[2]=d(e[2]);switch(e[2].toLowerCase()){case 'true':case 'yes':e[2]=true;break;case 'false':case 'no':e[2]=false;break;}
if(e[1]=='width'){e[1]='innerWidth';}
if(e[1]=='height'){e[1]='innerHeight';}
p[e[1]]=e[2];}
return p;};$.urlDataParams=function(innerWidth,innerHeight){return{'innerWidth':innerWidth,'innerHeight':innerHeight};};$.getParameterByName=function(name,href){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexString="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexString);var found=regex.exec(href);if(found==null){return "";}
else{return decodeURIComponent(found[1].replace(/\+/g," "));}};function hrefIsSafe(href){var normalizedUrl=Drupal.absoluteUrl(href);if(!Drupal.urlIsLocal(normalizedUrl)){return false;}
if(normalizedUrl.indexOf(Drupal.settings.colorbox.file_public_path)!==-1||normalizedUrl.match(/\/system\/files\//)||normalizedUrl.match(/[?|&]q=system\/files\//)){return false;}
return true;}})(jQuery);